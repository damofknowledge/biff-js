var Biff=function(C,h,w){var L=false,d=window.document,N=[],e=w?d.getElementById(w):d.body,B,y=C||320,o=h||480,a=[],r,F=false,s=[],u=[],J,l,g,j,v=false,p=false,K=false,M,f=false,m=("WebKitCSSMatrix" in window&&"m11" in new WebKitCSSMatrix());if(navigator.appVersion.match(/Android/ig)!==null){K=true}Array.prototype.i=Array.prototype.indexOf||function(P){for(var O=this.length;O--&&this[O]!==P;){}return O};var H=function(O,P){if(P.i(O)!==-1){P.splice(P.i(O),1);return true}else{return false}};var b=maxScore=0,n=b;var c=function(){n=b;if(F){BF_scoreDiv.innerHTML=n}};var x=function(O,P){return(~~((1/(60/O))*100)/100)*(P+1)};var q=function(){var O=N.length;while(O--){N[O].draw()}O=a.length;while(O--){if(f){M.update()}a[O]()}if(F){c()}};var G=function(){J=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(P,O){setTimeout(P,1000/60)}})();l=B.style;B.width=y;B.height=o;l.width=y+"px";l.height=o+"px";e.appendChild(B)};var k=function(){B=d.createElement("div");B.id="biff_stage";if(p){v=d.createElement("div");v.id="biff_controls";B.appendChild(v);BF_startDiv=d.createElement("span");BF_startDiv.id="biff_start";BF_startDiv.innerHTML="Start";v.appendChild(BF_startDiv);BF_pauseDiv=d.createElement("span");BF_pauseDiv.id="biff_pause";BF_pauseDiv.innerHTML="Pause";v.appendChild(BF_pauseDiv);BF_replayDiv=d.createElement("span");BF_replayDiv.id="biff_replay";BF_replayDiv.innerHTML="Replay";v.appendChild(BF_replayDiv)}if(F){if(d.getElementById("biff_score")){BF_scoreDiv=d.getElementById("biff_score")}else{BF_scoreDiv=d.createElement("div");BF_scoreDiv.id="biff_score";if(v){v.appendChild(BF_scoreDiv)}else{B.appendChild(BF_scoreDiv)}}}};var D=false,E=function(){q();if(D){r=J(E,B)}};var z=function(){D=false;clearTimeout(r)};var t=function(Q,P){var O=(Math.floor(Math.random()*(P)))+Q;return O};var i=function(){var U=s.length,R,Y,X,Q,W,V,P,Z,O,T,S;while(U--){Y=s[U];Q=Y.posY+Y.cZ.t;W=Y.posY+Y.height-Y.cZ.b;V=Y.posX+Y.cZ.l;P=Y.posX+Y.width-Y.cZ.r;for(R in s[U].hits){X=u[R];Z=X.posY+X.cZ.t;O=X.posY+X.height-X.cZ.b;T=X.posX+X.cZ.l;S=X.posX+X.width-X.cZ.r;if(!((Q>O)||(W<Z)||(V>S)||(P<T))){s[U].hits[R]()}}}};var I=function(R,P,Q,O,Y){var W=L?function(){}:function(){if(K){Z.s.background="url("+R+") no-repeat "+Z.width*Z.animation*-1+"px "+Z.height*Z.f*-1+"px"}else{Z.si.top=Z.height*Z.f*-1+"px";Z.si.left=Z.width*Z.animation*-1+"px"}},Z={},U=function(){var ac="@"+g+"keyframes s"+Z.id+" {\n",aa=100/(Z.fs+1),ad="% { "+g+"transform: translate(";for(var ab=0;ab<Z.fs+1;ab++){ac+=~~((aa*ab)*100)/100+ad+Z.animation*Z.width*-1+"px,"+ab*Z.height*-1+"px); }\n";ac+=~~((aa*(ab+1)-0.01)*100)/100+ad+Z.animation*Z.width*-1+"px,"+ab*Z.height*-1+"px); }\n"}return ac+="100"+ad+Z.animation*Z.width+"px, 0px); }\n}"};Z.id=N.length;Z.image=new Image();Z.image.src=R;Z.speed=1;Z.width=P;Z.iWidth=P;Z.height=Q;Z.iHeight=Q;Z.fs=O;Z.animations=Y;Z.colllides=false;Z.hits={};Z.f=0;Z.animation=0;Z.speed=1;Z.interval=0;Z.posX=0;Z.posY=0;Z.zOrder=1;Z.callback=null;Z.callIters=0;Z.callMaxIters=0;Z.cZ={t:0,r:0,b:0,l:0};Z.div=d.createElement("div");Z.div.id="sprite"+Z.id;Z.s=Z.div.style;Z.s.overflow="hidden";Z.s.width=P+"px";Z.s.height=Q+"px";Z.s.position="absolute";Z.s.zIndex=Z.zOrder;Z.si=Z.image.style;Z.si.position="absolute";if(L){Z.animStyle=d.createElement("style");Z.animStyle.innerHTML=U();d.body.appendChild(Z.animStyle);Z.si[j+"Animation"]="s"+Z.id+" "+x(Z.speed,Z.fs)+"s linear 0s infinite"}if(K){Z.s.background="url("+R+") no-repeat 0px 0px"}else{Z.div.appendChild(Z.image)}B.appendChild(Z.div);Z.id=N.push(Z)-1;u.push(Z);var X=function(aa,ac,ab){if(aa!==undefined){Z.posX=aa||Z.posX;Z.posY=ac||Z.posY;Z.zOrder=ab||Z.zOrder;Z.s.zIndex=ab||Z.zOrder;if(m){Z.s.webkitTransform="translate3d("+aa+"px,"+ac+"px,0)"}else{Z.s.left=aa+"px";Z.s.top=ac+"px"}return this}else{return{x:Z.posX,y:Z.posY,z:Z.zOrder}}},T=function(aa){if(aa&&s.i(Z)===-1){s.push(Z)}else{if(!aa&&s.i(Z)!==-1){H(Z,s)}}},V=function(aa,ab){T(true);Z.hits[aa.id()]=ab;if(s.i(Z)===-1){s.push(Z)}return this};Z.draw=function(){if(Z.fs>0){if(Z.interval==Z.speed&&Z.speed!==0){if(Z.f==Z.fs){Z.f=0;if(typeof Z.callback==="function"){Z.callIters++;if(Z.callIters===Z.callMaxIters){Z.callback();Z.callIters=0}}}else{Z.f++}Z.interval=0}if(Z.speed!==0){Z.interval++}W()}};var S=function(aa,ab){if(aa!==undefined){Z.s.width=aa+"px";Z.s.height=ab+"px";Z.si.width=aa*(Z.animations+1)+"px";Z.si.height=ab*(Z.fs+1)+"px";Z.width=aa;Z.height=ab;if(L){Z.si[j+"AnimationName"]="";Z.animStyle.innerHTML=U();Z.si[j+"AnimationName"]="s"+Z.id}return this}else{return{width:Z.width,height:Z.height}}};return{position:X,hit:V,zone:function(ad,ab,aa,ac){if(ad!==undefined){Z.cZ.t=ad;Z.cZ.r=ab;Z.cZ.b=aa;Z.cZ.l=ac;return this}else{return Z.cZ}},noHits:function(){Z.hits={};return this},callback:function(aa,ab){Z.callback=aa;Z.callMaxIters=ab;return this},change:function(ad,ab,aa,ae,ac){if(K){Z.s.background="url("+ad+") no-repeat 0px 0px"}else{Z.image.src=ad}Z.width=ab;Z.height=aa;Z.iWidth=ab;Z.iHeight=aa;Z.fs=ae;Z.animation=ac;Z.interval=0;Z.f=0;Z.callback=null;Z.callIters=0;Z.callMaxIters=0;Z.si.width=ab*(Z.animation+1)+"px";Z.si.height=aa*(Z.fs+1)+"px";Z.s.width=ab+"px";Z.s.height=aa+"px";if(L){Z.si[j+"AnimationName"]="";Z.animStyle.innerHTML=U();Z.si[j+"AnimationName"]="s"+Z.id}Z.cZ={t:0,r:0,b:0,l:0};return this},size:S,speed:function(aa){if(aa!==undefined){Z.speed=aa;Z.interval=0;if(L){Z.si[j+"AnimationDuration"]=x(aa,Z.fs)+"s"}return this}else{return Z.speed}},animation:function(aa){if(aa!==undefined){Z.animation=aa;if(L){Z.si[j+"AnimationName"]="";Z.animStyle.innerHTML=U();Z.si[j+"AnimationName"]="s"+Z.id}return this}else{return Z.animation}},frame:function(aa){if(aa!==undefined){Z.f=aa;return this}else{return Z.f}},id:function(){return Z.id}}};var A=function(Q,P,T,X){var U=function(){var Z=W.posX,Y=W.posY;if(Z.toString().indexOf("e")!=-1){Z=0}if(Y.toString().indexOf("e")!=-1){Y=0}B.style.backgroundPosition=Z+"px "+Y+"px"},W=this;var S=function(Y){B.style.backgroundImage="url("+Y+")"};S(Q);W.speed=P||3;var O=Math.PI/180,R=function(Y){W.dX=0;W.dY=0;if(typeof Y==="string"){switch(Y){case"N":W.dX=0;W.dY=-1;break;case"W":W.dX=-1;W.dY=0;break;case"S":W.dX=0;W.dY=1;break;case"E":W.dX=1;W.dY=0;break;default:break}}else{if(typeof Y==="number"){Y=O*Y;W.dX=Math.cos(Y);W.dY=Math.sin(Y)}}};R(T);W.zOrder=X.z||0;W.posX=X.x||0;W.posY=X.y||0;W.id=N.push(W);W.moving=0;var V=function(Y,Z){if(Y!==undefined){W.posX=Y||W.posX;W.posY=Z||W.posY;return this}else{return{x:W.posX,y:W.posY}}};W.draw=function(){W.posX+=W.speed*W.dX*W.moving;W.posY+=W.speed*W.dY*W.moving;U()};return{on:function(){W.moving=1;return this},off:function(){W.moving=0;return this},dir:function(Y){R(Y);return this},speed:function(Y){if(Y!==undefined){W.speed=Y;return this}else{return W.speed}},img:function(Y){if(Y!==undefined){S(Y);return this}else{return Q}},position:V}};return{fps:function(O){(function(){function P(){var R=d.createElement("script");R.type="text/javascript";R.async=true;R.src="stats.js";var Q=d.getElementsByTagName("script")[0];Q.parentNode.insertBefore(R,Q);setTimeout(function(){M=new Stats();M.domElement.style.position="absolute";M.domElement.style.right="0px";M.domElement.style.top="0px";var S=d.getElementById(O);S.appendChild(M.domElement);f=true},1000)}P()})();return this},controlsOn:function(){p=true;return this},scoreOn:function(O){if(O!==undefined){maxScore=O;F=true;return this}else{return maxScore}},score:function(O){if(O!==undefined){b+=O;if(b<0){b=0}return this}else{return b}},init:function(){k();G();return this},on:function(){D=true;E();if(L){var O=N.length;for(;O--;){if(N[O].image){N[O].image.style[j+"AnimationDuration"]=x(N[O].speed,N[O].fs)+"s"}}}return this},off:function(){D=false;z();if(L){var O=N.length;for(;O--;){if(N[O].image){N[O].image.style[j+"AnimationDuration"]=0}}}return this},running:function(O){return D},canvas:function(){return B},canvasOff:function(){if(typeof e.style.WebkitAnimation!=="undefined"){g="-webkit-";j="Webkit";L=true}else{if(typeof e.style.MozAnimation!=="undefined"){g="-moz-";j="Moz";L=true}}return this},cssAnimationOff:function(){L=false;return this},hitsOn:function(){if(a.i(i)===-1){a.push(i)}return this},hitsOff:function(){H(i,a);return this},spr:I,bg:A,rnd:t,hook:function(O){a.push(O);return this},unhook:function(O){H(O,a);return this}}};window.Biff=Biff;